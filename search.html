<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CODIUM Technical Standard | CODIUM Co., Ltd.</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CODIUM Technical Standard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CODIUM Co., Ltd." />
<meta property="og:description" content="CODIUM Co., Ltd." />
<link rel="canonical" href="https://codium.co/technical-standard/search.html" />
<meta property="og:url" content="https://codium.co/technical-standard/search.html" />
<meta property="og:site_name" content="CODIUM Technical Standard" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CODIUM Technical Standard" />
<script type="application/ld+json">
{"description":"CODIUM Co., Ltd.","url":"https://codium.co/technical-standard/search.html","@type":"WebPage","headline":"CODIUM Technical Standard","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/technical-standard/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://codium.co/technical-standard/feed.xml" title="CODIUM Technical Standard" /></head>
<body><header class="site-header">
    <div class="wrapper"><a class="site-title" rel="author" href="/technical-standard/">CODIUM Technical Standard</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <form action="/technical-standard/search.html" method="get">
    <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <input type="submit" value="search">
</form>

            </div>
        </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        

        <h1>Search Results</h1>

<ul id="search-results"></ul>

<script>
    

    window.store = {"angular": {
            "title": "Angular",
            "content": "",
            "url": "/technical-standard/angular"
        }, "devops": {
            "title": "DevOps",
            "content": "",
            "url": "/technical-standard/devops"
        }, "django": {
            "title": "Django",
            "content": "",
            "url": "/technical-standard/django"
        }, "search-html": {
            "title": "",
            "content": "Search Results\n\n\n\n\n\n\n",
            "url": "/technical-standard/search.html"
        }, "assets-main-css": {
            "title": "",
            "content": "@import \"minima\";\n",
            "url": "/technical-standard/assets/main.css"
        }, "angular-readme-sample-html": {
            "title": "Documentation",
            "content": "## Mock-up\n\n\nhttps://xd.adobe.com/view/something\n\n## API Documentation\n\n### Local Access\n\n\nhttp://localhost:8000/swagger\n\n### Internal Access\n\n\nhttps://dev.project.heroapp.dev/swagger\n\n(Use CODIUM network to access)\n\n# Application URLs\n\n## Local\n\n\nhttp://localhost:4200\n\n## Development Server\n\n\nhttps://dev.project.heroapp.dev\n\n## Staging Server\n\n\nhttps://staging.project.heroapp.dev\n\n## Production Server\n\n\nhttps://project.heroapp.dev\n\n# Requirements\n\n* Docker version >= 17.12.0-ce\n* docker-compose version >= 1.18.0\n* IntelliJ IDEA >= 2018.1\n\n# Setup Project (First time only)\n\n```sh\nmake setup-nvm\n```\n\n# Run Project\n\n```sh\nmake run-angular\n```\n\n# Accounts\n\n* admin\n  * username:admin\n  * password:P@ssword\n* user\n  * username:test_user\n  * password:P@assword\n\n# Miscellaneous Tools\n\n## Linting Project\n\n```sh\nmake lint-angular\n```\n\n## Testing Project\n\n```sh\nmake test-angular\n```",
            "url": "/technical-standard/angular/readme/sample.html"
        }, "django-readme-sample-html": {
            "title": "Requirements",
            "content": "* Docker version >= 17.12.0-ce\n* docker-compose version >= 1.18.0\n* IntelliJ IDEA >= 2018.1\n\n# Setup Project (First time only)\n\n## For Mac\n\n```sh\nmake reset-init-db\n```\n\n## For Ubuntu\n\n 1. Open terminal and run command below, make sure you are in project root directory\n ```sh nvm install 9.10.1 nvm install 8.10.0 make -s ubuntu-setup-project ```\n\n 1. Setup docker ip\n ```sh sudo bash manage-host.sh addhost host.docker.internal 127.0.0.1 ```\n\n# Run Project\n\n```sh\nmake run-django\n```\n\n# Accounts\n\n## API\n\n* url: `http://localhost:8000/`\n  * admin * username:admin * password:P@ssword\n  * user * username:test_user * password:P@assword\n\n## DB\n\n* url: `localhost:5432`\n* database: my_db\n* username: postgres\n* password: postgres\n\n# Miscellaneous Tools\n\n## Clean Project\n\n```sh\nmake clean-project\n```\n\ncommand above will clean docker container/images, reset db and run django\n\n## Reset DB\n\n```sh\nmake reset-init-db\n```\n\n## Dump DB\n\n```sh\nmake dump-local-db\n```\n\nYou will see file `mydump` in current directory.\n\n## Restore DB\n\n 1. Copy `mydump` file to `/django` folder\n 1. run command\n ```sh make restore-local-db ```",
            "url": "/technical-standard/django/readme/sample.html"
        }, "": {
            "title": "CODIUM Technical Standard",
            "content": "CODIUM standard for best practices.\n\nFull document is available at [https://c0d1um.github.io/technical-standard/](https://c0d1um.github.io/technical-standard/).\n\n## Overview\n\nProviding best practices from our own experiences.\n\n## Who is this for?\n\nThis document is for beginner to advance software developer, who is using similar\nto CODIUM technology stack.\n\n## Contributing\n\nMake sure you read the contributing guideline before submitting pull request.",
            "url": "/technical-standard/"
        }, "angular-authentication": {
            "title": "Authentication Guidelines",
            "content": "## Refresh Token\n\n### Main Component\n\nBy default, backend will set default token expiration time = 1 month. So, on frontend, the easiest way is just refreshing token every time when user refresh website. You can do by adding code below in your `main.component.ts`\n\n```ts\nexport class MainComponent implements OnInit { ngOnInit() {     // call refresh token API     this.authService.refreshToken({refresh: localStorage.refresh}).subscribe(         (data: Token) => {             // save token and user information to local storage.             localStorage.setItem('currentUser', data);         },         (error) => {             // if error occurs, you may use old token and do nothing.             return;\n             // or redirect to login page.             // this.router.navigate(['/login']);         }     ); }\n}\n```\n\n### (Optional) Short Expiration Time\n\nIf token time is very short (Ex. Banking website which token is expired in 5 minutes), you must check token expiration time before calling request and refresh token if needed. See code below.\n\n```ts\nfunction refreshTokenIfExpired () { // decode jwt token. This is very technical, you can skip this part if you don't understand. let base64Url = localStorage.currentUser.split('.')[1]; let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/'); let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {     return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2); }).join(''));\n let decoded = JSON.parse(jsonPayload); const now = Date.now().valueOf() / 1000\n let refreshToken = false // check if token will be expired in 5 minutes (300000 = 5 minutes) let FIVE_MINUTES = 5 * 60 * 1000; if (typeof decoded.exp !== 'undefined' && decoded.exp  now - FIVE_MINUTES) {     refreshToken = true }\n // call refresh token if it is nearly expired. if (refreshToken) {     this.authService.refreshToken( ... ) }\n};\n```\n\n# Authentication Token Interceptor\n\nAuthentication token interceptor will add token to request.\n\n```ts\nimport {Injectable} from '@angular/core';\nimport {HttpEvent, HttpHandler, HttpInterceptor, HttpRequest} from '@angular/common/http';\nimport {Observable} from 'rxjs';\n\nimport {environment} from '../../../environments/environment';\n\n@Injectable()\nexport class JwtInterceptor implements HttpInterceptor {\n  constructor(private authenticationService: AuthenticationService) {\n  }\n\n  intercept(request: HttpRequest, next: HttpHandler): Observable> { // handle request that don't want to add authentication header. // Sample Code: `this.http.get('https://somewebsite/', {headers:{skip:\"true\"})` if (req.headers.get(\"skip\")) {    return next.handle(req); }\n // add auth header with jwt if user is logged in and request is to the api url const currentUser = localStorage.currentUser; const isApiUrl = request.url.startsWith(environment.baseUrl);\n if (currentUser && isApiUrl) {   request = request.clone({     setHeaders: {       Authorization: `Bearer ${currentUser}`     }   }); }\n return next.handle(request);\n  }\n}\n```\n\n# LocalStorage\n\nLocalStorage size is limited to about 5MB. Make sure that you don't save large files (Ex. profile pictures). You should download file from backend server instead.\n\n```ts\n# Bad. Do not save files data into localstorage. Size limit is about 5 MB.\nlet bytes = .... \nlocalStorage.setItem('file', bytes)\n```\n\n## LocalStorage VS SessionStorage\n\nYou should not save user profile into SessionStorage. Different between LocalStorage and SessionStorage is below.\n\n* LocalStorage will save data and share that data when user open second tabs.\n* SessionStorage will not share data when across tabs.\n* SessionStorage will automatically deleted when user close tab, but does not delete when user refresh website.\n\nHere is what happen if you use SessionStorage to save user token/profiles.\n\n* If user open second tabs of the same website and user profile changes, it will not change on the first tab.\n* If user logout from the first tabs, second tab is still logged in.\n* User have to login again when close tab and open a new one.\n\n## LocalStorage VS Cookie\n\nYou should not save user profile and authentication token into cookies because it can be hacked by 'CSRF' method. More info on this [link](https://hydrasky.com/network-security/cross-site-request-forgery-csrf/)\n\n# Prevent Authentication Hacking\n\n* Use https all the time.\n* You should use LocalStorage to save user profile/authentication token (not cookie. see topic above)\n* When user refresh website, frontend should refresh user profile (see topic \"Refresh Token\" above).\n* You should not send password or sensitive information in GET method. Even though GET param is encrypted in https but it may be logged in Nginx or Django.",
            "url": "/technical-standard/angular/authentication/"
        }, "angular-readme": {
            "title": "Angular README Instructions",
            "content": "This page will give you recommendations on how to write `README.md` file for your Angular project.\n\n## Topics\n\n README.md ├── Documentation │   ├── Wireframe/Mock-up │   │   # or any design for the project │   │ │   └── API Documentation │       # such as how to access it, credential (if any) │ ├── Application URLs │   # URLs for local development, development server, staging (if any) server, and production server. │ ├── Requirements │   # requirement version of Docker, Docker-Compose, etc. │ ├── Setup Project │   # Steps for setup project for the first time. │ ├── Run Project │   # Steps for running project after developer have already setup the project. │ ├── Accounts │   # Account for login to application for admin and regular user. │ ├── Miscellaneous Tools │   ├── Linting Project │   │   # Steps for linting project │   │ │   └── Testing Project │       # Steps for testing project │ └── Other topics      # For example, troubleshooting, feature flags, monitoring systems, etc.\n\n\n## Example\n\nSee sample [here](/technical-standard/angular/readme/sample.html)",
            "url": "/technical-standard/angular/readme/"
        }, "angular-securities": {
            "title": "Security",
            "content": "Best practices for Angular Security.\n\n## Official Best Practices\n\nHere is the [url](https://angular.io/guide/security) to the official security\nbest practices.\n\nBelow are additional best practices provided from experiences.\n\n## Storing Data\n\nTry not store anything in browser, since it's on client side that mean client\ncan do anything on their machine. Remember that any data that's stored on\nbrowser, you must find a way to protect it.\n\n### What are the data you can store in browser?\n\n- API Access Token\n- Role Information\n- Session ID\n\n### What if I want to store a Session data?\n\nThis must be handle by backend. Backend can generate a unique session id, then\nfrontend can use this Session ID combine with API Access Token, to add or get\nsession data from backend.\n\n### How do we protect Role information?\n\nTo prevent user pretend to be other role, backend API must check role info\nevery time calling API. If not authorized, backend can response HTTP 401 status\ncode. Then frontend can use response status for further step.\n\n## HTTPS\n\nAlways serve using HTTPS, HTTPS help prevent middleman tampering data send and\nreceive between client and server.",
            "url": "/technical-standard/angular/securities/"
        }, "devops-git-flow": {
            "title": "Git Flow",
            "content": "In this standard, we suggest you multiple implementations of Git Flow. Each flow is different. Some is better when you're developing, some is better when your project was already go live. This standard will help you pick the right one for your project.\n\nBefore we start, one thing that's constant is we will use only _one branch_ as a standard.\n\n## TL;DR\n\n### Flows\n\nThere are three flows we suggested you in this standard:\n\n1. **Centralized Workflow:** only master branch and all changes are committed into master.\n1. **Feature Branching:** have master and feature branch(es).\n1. **Trunk-based Development**: it is like _Feature Branching_ but feature branch is very short-lived and will be merged into master as fast as possible. Project should also implement [feature flags](#feature-flag) to turn on/off feature as well.\n\n### Flow Selection\n\nHere's how you choose a Git Flow for your project:\n\n| ![Flow Selection](https://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/C0D1UM/technical-standard/main/devops/git-flow/flow-selection.plantuml) |\n| :--: |\n| _Flow Selection_ |\n\n### Comparison\n\n| Topic | Centralized Workflow | Feature Branching | Trunk-based Development |\n| ----- | -------------------- | ----------------- | ----------------------- |\n| **Development** |\n| Number of branch | 1 | 1 | 1 |\n| Branching | - | By feature | By feature |\n| Branch live | - | Long-lived | Short-lived |\n| When to merge? | - | When feature is done | Depends but every often(everyday, every 2 days, etc.) |\n| Code review | No | Possible | Recommended |\n| Maximum number of developers | 2 | N/A | N/A |\n| **Deployment** |\n| Development Server | On pushed to _main branch_ | On pushed to _main branch_ | On pushed to _main branch_ |\n| Staging Server (if any) | Manually deploy from _main branch_ | Manually deploy from _main branch_ | On pushed to _release branch_ |\n| Production Server | On tag pushed from _main branch_ | On tag pushed from _main branch_ | On tag pushed from _release branch_ |\n\n## Centralized Workflow\n\n|  |\n| :--: |\n| _Centralized Workflow_ |\n\n### Concepts\n\n- Developers work on a single branch (usually named `main`)\n- Developers push directly to main branch without any branching required\n\n### Deployment\n\n- **Development:** Deploy when pushed into _main branch_\n- **Staging _(if any)_:** Manually deploy from _main branch_\n- **Production:** Manually deploy by creating a tag from _main branch_\n\n### When do you want?\n\n- Project is in _starting or first phase_\n- Team has only a few developers in the team\n- Developers are advanced since there is no code review\n- Need to speed up the process\n\n### References\n\n- [Atlassian: Centralized Workflow](https://www.atlassian.com/git/tutorials/comparing-workflows#centralized-workflow)\n\n## Feature Branching\n\n|  |\n| :--: |\n| _Feature Branching_ |\n\n### Concepts\n\n- A single _main branch_ (usually named `main`)\n- Branching is required to develop a new feature, enhancements, bug fixes, and etc.\n- Frequently merge _main branch_ to _feature branch_\n- When it is finished, code review (including pipelines) is required before merging into _main branch_.\n- Delete _feature branch_ immediately after it has been merged\n\n### Deployment\n\n- **Development:** Deploy when pushed into _main branch_\n- **Staging _(if any)_:** Manually deploy from _main branch_\n- **Production:** Manually deploy by creating a tag from _main branch_\n\n### When do you want?\n\n- Project is in _development phase_ or _support phase_\n- Team has senior developers enough to review the code for every other developers\n- There are many features or tasks to do and they need to be implemented at the same time\n\n### References\n\n- [Atlassian: Feature Branch Workflow](https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow)\n\n## Trunk-based Development (with Feature Flag)\n\n| ![Trunk-based Branching](https://trunkbaseddevelopment.com/trunk1c.png) |\n| :--: |\n| _Trunk-based Development_ |\n\n### Concepts\n\nSimilar as [Feature Branching](#feature-branching) but\n\n- There is a separated branch called `release` to freeze the development in a certain time, preparing to deploy to staging (if any) or production.\n- Feature branches are _short-lived_\n- Every point in _main branch_ should be _production-ready_. Here comes the [Feature Flag](#feature-flag).\n\n### Feature Flag\n\n**Feature Flag**[1] (aka. Feature Toggle) is the ability to turn on or turn off every particular feature without re-deploying which is a time-consumed task.\n\nFeature Flag also helps us to turn off a feature that we don't want to release as well. This will allow us to merge our code as fast as possible to _main branch_ without considering that it will be released on production or not.\n\n### Deployment\n\n- **Development:** Deploy when pushed into _main branch_\n- **Staging _(if any)_:** Deploy when pushed into _release branch_\n- **Production:** Deploy when pushed tag created from _release branch_\n\n### When do you want?\n\n- Project is in _go-live phase_ but there are features left to be implemented as well as fixing bugs in production server\n- Release schedule is strictly\n- Has enough senior developers to review everyone's code\n- Already set-up CI/CD\n\n### References\n\n- [Trunk Based Development](https://trunkbaseddevelopment.com/)\n- [1] [Feature flags, what are they?](https://launchdarkly.com/blog/what-are-feature-flags)",
            "url": "/technical-standard/devops/git-flow/"
        }, "django-datetime": {
            "title": "Datetime",
            "content": "## Python\n\nThere are two different kind of datetime in Python\n\n1. Naive Datetime - datetime without timezone\n1. Aware Datetime - datetime with timezone\n\n## Django Configuration\n\nAlways enable timezone support in Django `settings.py`\n\n```py\n# django\nUSE_TZ = True\nTIME_ZONE = \"Asia/Bangkok\"\n\n# celery\nCELERY_TIMEZONE = \"Asia/Bangkok\"\n```\n\n## Datetime Comparison\n\nWhen you are getting data from the database you will get the Aware Datetime.\nIf you need to compare it with a Datetime object, it should be Aware Datetime object see [below](#get-current-datetime).\n\n## Get current datetime\n\nUse `timezone.now()` or `timezone.localtime` over `datetime.now()`\n\n```py\nimport datetime\n\nfrom django.utils import timezone\n\n# Yes\nnow = timezone.now() # get current Aware datetime in UTC\n\nnow = timezone.localtime() # get current Aware datetime in Asia/Bangkok\n\n\n# No\nnow = datetime.datetime.now() # get current Naive datetime\n```\n\n## Convert Naive Datetime to Aware Datetime\n\n```py\nimport datetime\n\nimport pytz\n\n# Yes\nnow = datetime.datetime.now() # current Naive datetime\n\ntz = pytz.timezone(\"Asia/Bangkok\")\naware_now = tz.localize(now)\n\n# No\nnow = datetime.datetime.now() # current Naive datetime\n\ntz = pytz.timezone(\"Asia/Bangkok\")\naware_now = now.replace(tzinfo=tz) # return wrong datetime\n\n```\n\n## Convert Aware Datetime to different timezone\n\n```py\nfrom django.utils import timezone\n\nimport pytz\n\nnow = timezone.now() # current datetime in UTC\n\ntz =  pytz.timezone(\"Asia/Bangkok\")\n\nbkk_now = now.astimezone(tz) # get current datetime in Asia/Bangkok\n```",
            "url": "/technical-standard/django/datetime/"
        }, "django-email": {
            "title": "Sending Email",
            "content": "Best practices when working on sending email feature.\n\n## Use Django Build-in Email Backend\n\nRead more [https://docs.djangoproject.com/en/3.1/topics/email/](https://docs.djangoproject.com/en/3.1/topics/email/).\n\n## Email Body Best Practices\n\nSome email client like GMail scan the email body before notify user so here some\nbest practices preventing email not received by customer immediately.\n\n- Use plain-text email if possible\n- When include url always display it to user, do not hide it. Client like GMail\nwill scan to see if the given url is redirect to page as it says.\n- Allow user to unsubscribe the newsletter, by adding a url redirect to a form\nthat unsubscribe user from newsletter.\n\n## Prevent Actually Send Email to Customer\n\nThere might be time that you would like to debug or fix email sending bug, and\nyou dump data from the production to reproduce. There are high chances that you\naccidentally send email to actual customer since you are using production\ndatabase. Below are some best practices handling this problem:\n\n### Domain Name Filtering\n\nIn Django settings file, you should have a setting that only allow email to send\nto specific email address.\n\n```python\n# settings.py\nALLOW_EMAIL_DOMAINS = env.list('ALLOW_EMAIL_DOMAINS', default=['codium.co'])\n\n# send_email.py\nreceivers = [ 'a@codium.co', 'b@gmail.com', 'c@sale.com',\n]\n\nallowed_receivers = []\n# Do the filtering\n# After filtered, allowed_receivers should has only ['a@codium.co']\n\nfrom django.core.mail import send_mail\nsend_mail( 'Subject', 'Message', allowed_receivers, fail_silently=False\n)\n```\n\nSo before sending email, you can filter for only domain name in allowed list.\n\n**Note:** SendGrid is not allow duplicated receiver addresses.\n\n### Log Email to Console\n\nThe second solution is when running local environment you can use Django console\nemail backend. When define this in `settings.py` it will only log email to\nconsole instead of actually connecting to SMTP server and send email.\n\n```python\n# settings.py\nEMAIL_BACKEND = env( var='DJANGO_EMAIL_BACKEND', default='django.core.mail.backends.console.EmailBackend'\n)\n```\n\n### MailHog\n\nUsing MailHog allowed you to actually send email via SMTP without delivering\nto the client email server. It also provided a simple web interface, so we able\nto check the sent email. Here the simplest setup using `docker-compose`:\n\n```yml\nversion: '3'\nservices: mail:     image: mailhog/mailhog     port:         - 1025:1025 # SMTP Server         - 1080:1080 # Web UI\n```\n\n**Note:** MailHog purposes is only for testing small amount of emails, when\nsent large amount of email to MailHog, it will show some performance issue like\nmail is missing or slow loading.\n\n## Using SendGrid\n\n### REST API vs SMTP\n\nFrom experiences, SendGrid email is more stable when using API, so I would\nrecommend using SendGrid API instead of SMTP.\n\n### Dedicate IP Address\n\nUse dedicate ip feature when ever possible (this is a pay feature). By using a\ndedicated IP, allow us to not use the shared IP from SendGrid. Since the\nshared IP address is free, people try to use it for bad purposes and this\ncause those shared IP to be banned from some email server like HotMail, Gmail,\netc., so if you wonder why email is not received by the customer,\nthis could be the reason.",
            "url": "/technical-standard/django/email/"
        }, "django-import-export-excel": {
            "title": "Recommended Library",
            "content": "These are the libraries that is recommended to use when working with Excel.\n\n- [OpenPyXL](https://openpyxl.readthedocs.io/en/stable/) this library allow us to\neasily handling excel.\n- [PyExcelerate](https://github.com/kz26/PyExcelerate) this library is used when\nyou need only speed meaning there is only data in the excel file, but if you need\npersonalization like color space it's not recommended.\n- [Django Excel Tools](https://github.com/NorakGithub/django-excel-tools) this library\nis used to validate data from excel.\n\n# Import Data From Excel\n\nHere are some best practices when working with importing data from excel.\n\n## Data Validation\n\nIt is important to import correct data to our system, and we're not able to\ntrust if user only fill the correct data. So before importing data to the system,\neach row and column must be validated. Doing this manually would take\ntoo much time, so I would recommend using [Django Excel Tools](https://github.com/NorakGithub/django-excel-tools) for data validation.\n\n## Simple Technique\n\n### When to use this technique?\n\nThe data importing will never be more than 2000 rows. (Tip validation and raise\n400 when data is more than 2000 rows)\n\n### How?\n\nThis would required a minimal setup, here the guides:\n\n- User upload the excel.\n- API received excel, and validate data inside excel.\n- Import data to the system.\n- When import data to the database try to import in chunks, says you have 2000\nrows of data you split it into 500 rows each to import to the database.\n- Return import status back to user.\n\nOverall process should not take any longer than 30 seconds.\n\n### Architecture\n\n![Simple Architecture](/technical-standard/django/import-export-excel/img/simple-architecture.jpeg)\n\n## Advance Technique\n\n### When to use this technique?\n\nYou don't know how many rows will be imported to the system at a time.\n\n### How?\n\nThis would required more setup because we will need background workers (Celery),\nhere are some guides:\n\n- User upload the excel.\n- API received excel, and validate data inside excel.\n- After data validated, send file to background worker, then return status 203 as\nthe task has been accepted.\n- When importing to database try to split into chunks, says you have 100,000 of\nrows, you should split into 5,000 each time importing to the database.\n- (Optional) Use more than one worker, so that you can import data in parallels.\n- Use COPY instead of INSERT. There are limitation when using COPY, but COPY is\nway more faster than INSERT. Read more about COPY [here](https://www.postgresql.org/docs/9.2/sql-copy.html).\n\n### Architecture\n\n#### Minimum\n\n![Advance Architecture](/technical-standard/django/import-export-excel/img/advance-minimum-architecture.png)\n\n#### Recommended\n\nIt's recommended to separate between worker and API server because usually workers\nwill use a lot of resources, so if workers down it wouldn't affect API Server.\n\n![Advance Architecture](/technical-standard/django/import-export-excel/img/advance-recommended-architecture.png)\n\n# Export Data to Excel\n\nHere are some best practices when working with exporting data from database to\nexcel.\n\n## Simple\n\n### When to use this technique?\n\nIf the data to export is no more than 2000 rows.\n\n### How?\n\nThis would required a minimal setup, here the guides:\n\n- User request excel report via API.\n- API Server received request then query the database.\n- Return excel report via api.\n\n### Architecture\n\n![Simple Architecture](/technical-standard/django/import-export-excel/img/simple-architecture.jpeg)\n\n## Advance\n\n### When to use this technique?\n\nIf you have no idea how many rows it's gonna be or it will be more than 2000 rows.\n\n### How?\n\nThis would required more setup because we will need background workers (Celery),\nhere are some guides:\n\n- User request excel file via API.\n- API server received the request, then send this job to background worker,\nfinally response 203 status code meaning the job is successfully accepted.\n- In worker, when query data from database it's recommend to split it chunks.\nSays 2000 rows per query, you can use SQL `LIMIT` and `OFFSET` (using [Django](https://docs.djangoproject.com/en/3.1/topics/db/queries/#limiting-querysets)) to achieve this.\nThis prevent database from crashing when requesting too much data at once.\n- (Optional) Use more than one worker, so we can export data in parallels.\n\n*Note: Using `OFFSET` might cause performance problem later on, but this method\nproviding easier to implement. If that the case, you can sort the data and use\n`WHERE` instead (you can also achieve this with Django).*\n\nExample:\n\n```sql\nselect *\nfrom tbl_name\norder by id\nwhere id < 2000\nlimit 2000\n```\n\n### Architecture\n\n#### Minimum\n\n![Advance Architecture](/technical-standard/django/import-export-excel/img/advance-minimum-architecture.png)\n\n#### Recommended\n\nIt's recommended to separate between worker and API server because usually workers\nwill use a lot of resources, so if workers down it wouldn't affect API Server.\n\n![Advance Architecture](/technical-standard/django/import-export-excel/img/advance-recommended-architecture.png)\n\n# Progress\n\nFor a better UX, we should displaying the progress of import/export data to user.\nThere are multiple ways of doing this:\n\n- Provide an API Endpoint for frontend to call every, says 5 seconds, and frontend display progress to user.\nAPI response payload should contain progress value. This is easy to implement, but kinda\nbad for the performance and resource usage.\n- Using Web Socket that wait for push event from backend. This is not easy to implement, but better in term\nof performance and resource usage.",
            "url": "/technical-standard/django/import-export-excel/"
        }, "django-models": {
            "title": "Model",
            "content": "Best practices for creating model class.\n\n## Common\n\nThese are some of the best practices that you should add to your model class.\n\n### The String Representation Function\n\nBy default django will use id when we try to print the object.\n\n```python\n\nobj = Model.objects.first()\nprint(obj)\n>>> \n```\n\nIt's easier to debug when you get more information regarding the object.\n\n```python\nclass Person(models.Model): first_name = models.CharField(max_length=50) last_name = models.CharField(max_length=50) position = models.ForeignKey(     to='people.Position',     on_delete=models.CASCADE,     related_name='people', )\n # String function that you should add def __str__(self):     return f'{self.first_name} {self.last_name}'\n```\n\nWhen trying to debug:\n\n```python\nperson = Person.objects.first()\nprint(person)\n>>> \n```\n\n**CAUTION**: You should not use foreign key field in your string function,\nbecause this could lead to performance problem.\n\n```python\n# No\ndef __str__(self): return f'{self.first_name} {self.last_name} {self.position.name}'\n\n# If your query is not select_related position, this will hit database\n# with the amount of people.\n```\n\n## Fields\n\nBest practices when defining field in model.\n\n### Naming\n\n- Field name should be **noun** and in **singular** form, except\nfor many-to-many field should be **plural** form.\n- Boolean field should be **verb** with past tense.\n- Do not repeat model name in field name.\n- Related name parameter value should be **plural** form.\n\n```python\nclass Person(models.Model): # Yes: Singular noun first_name = models.CharField(max_length=100) # No : Repeat model name person person_first_name = models.CharField(max_length=100)\n # Yes: Many to Many in plural form companies = model.ManyToMany(to='company.Company', blank=True, related_name='people')\n # Yes activated = models.BooleanField() # No is_active = models.BooleanFiled()\n```\n\n### Relationship\n\n- When defining foreign key, one to one or many to many in a model it should be\nlazy reference instead of importing the model class directly, preventing\ncircular or recursive import exception.\n[Read more](https://docs.djangoproject.com/en/3.1/ref/models/fields/#foreignkey)\n- Always add related name parameter to foreign key or many to many field. If you\ndon't want Django to create backward relation, add '+' to the `related_name` parameter.\n\n```python\n# Yes\nclass Employee(models.Model): # Create backward relation person = models.ForeignKey(to='people.Person', on_delete=models.CASCADE, related_name='employees') # Do not create backward relation person = models.ForeignKey(to='people.Person', on_delete=models.CASCADE, related_name='+')\n\n# No\nfrom people.models import Person\nclass Employee(models.Model): person = models.ForeignKey(to=Person, on_delete=models.CASCADE)\n```\n\n### Related Name\n\nBy default the related name of a relationship field is `{field_name}_set`,\nso by adding `related_name` parameter make the code cleaner and more readable.\n\n```python\n# Yes\nclass Employee(models.Model): person = models.ForeignKey(     to='people.Person',     on_delete.CASCADE,     related_name='employees' )\n\nperson = Person.objects.first()\nperson.employees.all()\n\n# No\nclass Employee(models.Model): person = models.ForeignKey(to='people.Person', on_delete.CASCADE)\n\nperson = Person.objects.first()\nperson.employee_set.all()\n```\n\n## Model Controller\n\nModel Controller is a third party library that we use to keep track of data\nin each row, sometimes we would like to know when this row was create or\nupdate or who create or update this row.\n\nFor installation and setup\n[read here](https://github.com/NorakGithub/django-model-controller) 1\n\n```python\nfrom model_controller.models import AbstractSoftDeletionModelController\n\n\nclass Person(AbstractSoftDeletionModelController): pass\n```\n\nWith this abstract class you get 5 fields:\n\n- `alive`: instead of delete row from database we just change the `alive` field to `null`, so that we can recover this row later.\n- `created_user/updated_user`: these fields are foreign key to `User` model. If you are using `ModelControllerSerializer` it will automatically add these field for you.\n- `created_at/updated_at`: these fields store the datetime fields when the record was created or latest update.\n\nTwo important things you need to know after extended\n`AbstractSoftDeletionModelController`:\n\n- It overwrite the `delete()` method so that when you call delete method in your model object it will update `alive = null` instead of actually delete the object.\n- It provided you with two managers `objects` and `all_objects`\n\n```python\n# This will return person that alive is true\nPerson.objects.all()\n\n# This will return all person rows in database include alive is null\nPerson.all_objects.all()\n```\n\n### Unique\n\nWhen using `AbstractSoftDeletionModelController` if you want to make field value\nunique, make sure you use `unique_together` with `alive` field instead of\nfield unique. Use `UniqueConstraint` with Django >= 2.0.\n\n```python\n# Yes\nclass Person(AbstractSoftDeletionModelController): username = model.CharField(max_length=100)\n class Meta:     # Django = 2.0     constraints = (         models.UniqueConstraint(fields=('username', 'alive'), name='unique-username')     )\n\n\n# No\nclass Person(AbstractSoftDeletionModelController): username = models.CharField(max_length=100, unique=True)\n```\n\nBy using `unique_together` it allow you to create only 1 record if it's alive,\nyou can recreate the same object if `alive is null`.\n\n**FAQ:** Why we set alive to null instead of false when delete?\n\n| id | username | alive |\n| -- | -------- | ----- |\n| 1  | sample   | false |\n| 2  | sample   | fasle |\n\nIf you are using unique together, this case is not possible because data with id\n1 is already exists.\n\n| id | username | alive |\n| -- | -------- | ----- |\n| 1  | sample   | null  |\n| 2  | sample   | null  |\n\nThis case is possible because database will ignore null field.\n\n## Managers\n\nThis is where you add reusable query, it make query more maintainable and\nreadable.\n\nIf you are using `AbstractSoftDeletionModelController` make sure to extend\nyour manager from `SoftDeletionManager`.\n\n```python\nfrom model_controller.managers import SoftDeletionManager\n\n\nclass PersonManager(SoftDeletionManager):\n def get_with_employees(self):     query = self.get_query()     return query.prefetch_related('employees')\n```\n\nRegister to your model\n\n```python\nclass Person(AbstractSoftDeletionModelController): ... objects = PersonManager()\n```\n\nExample usage\n\n```python\npeople = Person.objects.get_with_employees()\n```\n\n### Reference\n\n- [Official Doc](https://docs.djangoproject.com/en/3.1/topics/db/managers/)\n- [Project Structure](django/project-structure/README.md)\n(where should your manager be)\n\n---\n1 *At the time of writing, the latest version is\n`django-model-controller==0.4.2`*.",
            "url": "/technical-standard/django/models/"
        }, "django-permissions": {
            "title": "Permissions",
            "content": "* Keep permissions inside `permissions.py`\n* Check [third-party packages](https://www.django-rest-framework.org/api-guide/permissions/#third-party-packages) before writing your own permission classes\n* Function-based views will need to check object permissions explicitly by calling `.check_object_permissions(request, obj)`, raising `PermissionDenied` on failure.\n\n## Default permission policy\n\nAlways provide the default permission classes in `settings.py`\n\n```python\n# settings.py\n\nREST_FRAMEWORK = { 'DEFAULT_PERMISSION_CLASSES': [     'rest_framework.permissions.IsAuthenticated', ]\n}\n```\n\n## Example permission class\n\n```python\n# permissions.py\n\nfrom rest_framework import permissions\n\n\nclass ReadOnly(permissions.BasePermission): def has_permission(self, request, view):     return request.method in permissions.SAFE_METHODS\n\n```\n\n## Compose permissions\n\nMany permission classes can be composed by Python bitwise operators.\n*Note: It supports `&` (and), `|` (or) and `~` (not).*\n\n```python\n# views.py\n\nfrom rest_framework import permissions\nfrom rest_framework import response\nfrom rest_framework import views\n\nclass ExampleView(views.APIView): permission_classes = [permissions.IsAuthenticated|permissions.ReadOnly]\n def get(self, request, format=None):     content = {         'status': 'request was permitted'     }     return response.Response(content)\n\n```\n\n## View level permission\n\nExample\n\n```python\n# permissions.py\n\nfrom rest_framework import permissions\n\nclass BlocklistPermission(permissions.BasePermission): \"\"\" Global permission check for blocked IPs. \"\"\"\n def has_permission(self, request, view):     ip_addr = request.META['REMOTE_ADDR']     blocked = Blocklist.objects.filter(ip_addr=ip_addr).exists()     return not blocked\n```\n\n## Object level permission\n\nFor clarification, use `has_object_permission` over `has_permission` as in [View level permission](#view-level-permission).\n\n```python\n# permissions.py\n\n# Yes\nclass IsOwnerOrReadOnly(permissions.BasePermission): def has_object_permission(self, request, view, obj):\n     if request.method in permissions.SAFE_METHODS:         return True\n     return obj.owner == request.user\n\n\n# No\nclass IsOwnerOrReadOnly(permissions.BasePermission): def has_permission(self, request, view):     obj = view.get_object()\n     if request.method in permissions.SAFE_METHODS:         return True\n     return obj.owner == request.user\n\n```",
            "url": "/technical-standard/django/permissions/"
        }, "django-project-structure": {
            "title": "Project Structure",
            "content": "## Introduction\n\nThe difference in structure of each project makes it developers difficult to understand the code. This standard comes to solve this problem and to reduce the time used when developers study the project.\n\n## Structure\n\n> **IMPORTANT:** Every file/directory name should be [snake_case](https://en.wikipedia.org/wiki/Snake_case)\n\n> **Note:** `__init__.py` is omitted\n\n • ├── [project_name]/ │   ├── apps/ │   │   ├── common/ 19 │   │   │   └── fixture_templates.py  │   │   │   └── .. │   │   ├── [app1_name]/ 1 │   │   │   ├── fixtures/ 21 │   │   │   ├── management/ │   │   │   │   └── commands/ │   │   │   ├── migrations/ │   │   │   ├── templates/ │   │   │   │   ├── css/ 11 │   │   │   │   ├── fonts/ 11 │   │   │   │   ├── images/ 11 │   │   │   │   └── [template_name].html │   │   │   ├── tests/ │   │   │   │   ├── test_[topic_name].py │   │   │   │   └── .. │   │   │   ├── admin.py │   │   │   ├── apps.py │   │   │   ├── choices.py 12 │   │   │   ├── exceptions.py │   │   │   ├── factories.py 13 │   │   │   ├── filters.py 14 │   │   │   ├── functions.py 15 │   │   │   ├── managers.py │   │   │   ├── models.py │   │   │   ├── paginations.py │   │   │   ├── permissions.py │   │   │   ├── serializers.py │   │   │   ├── services.py 20 │   │   │   ├── signals.py │   │   │   ├── tasks.py 16 │   │   │   ├── utils.py 17 │   │   │   └── views.py │   │   │   └── .. │   │   ├── [app2_name]/ │   │   │   └── .. │   │   └── .. │   ├── api_urls.py 2 │   ├── asgi.py 7 │   ├── celery.py 8 │   ├── settings.py │   ├── urls.py 3 │   └── wsgi.py 9 ├── locales/ │   ├── [lang]/ │   │   └── LC_MESSAGES/ │   │       └── django.po │   └── .. ├── static/ 10 │   ├── css/ │   ├── fonts/ │   ├── images/ │   └── .. ├── .flake8 4 ├── .coveragerc 5 ├── .gitignore 6 ├── Dockerfile ├── manage.py ├── requirements.in 18 └── requirements.txt 18\n\n\n### Explanation\n\n#### [1] Application Name\n\nEvery applciation name should be **noun**, is in the **plural** form, and using underscore (`_`) to improve readability [*]. `common` is an exception.\n\n```python\nmemos            # Yes\nmonthly_reports  # Yes\n\nperson           # No, because it is in singular form\nexternalservices # No, because it didn't use underscore\n```\n\n[*] There is no best practice choosing between singular or plural form but it should match [PEP8's Package and Module Names](https://www.python.org/dev/peps/pep-0008/#package-and-module-names).\n\n#### [2] `api_urls.py`\n\nIt should contains only [Django REST Framework's router and urlpatterns](https://www.django-rest-framework.org/api-guide/routers/).\n\n#### [3] `urls.py`\n\nIt should contains only top-level `urlpatterns`. That is `urlpatterns` from any other packages including [`api_urls.py`](#sup2sup-codeapi_urlspycode)\n\n#### [4] `.flake8`\n\nSee: [Flake8](https://flake8.pycqa.org/en/latest/)\n\n#### [5] `.coveragerc`\n\nSee: [Coverage.py](https://coverage.readthedocs.io/)\n\n#### [6] `.gitignore`\n\nIt should contains only `gitignore` for Django/Python application only.\n\nSee: [What is .gitignore?](https://www.freecodecamp.org/news/gitignore-what-is-it-and-how-to-add-to-repo/)\n\n#### [7] `asgi.py`\n\nIt is not required if your application is not using [ASGI](https://docs.djangoproject.com/en/3.1/howto/deployment/asgi/).\n\n#### [8] `celery.py`\n\nIt is not required if your application is not using [Celery](https://docs.celeryproject.org/en/stable/index.html).\n\n#### [9] `wsgi.py`\n\nIt is not required if your application is not using [WSGI](https://docs.djangoproject.com/en/3.1/howto/deployment/wsgi/).\n\n#### [10] Static Across Applications\n\nStatic files here should be used across many applications in the project.\n\n#### [11] Static for Application's Template\n\nStatic files here should be used only in the certain application's template.\n\n#### [12] `choices.py`\n\nContains [Django's Enumeration types](https://docs.djangoproject.com/en/3.1/ref/models/fields/#enumeration-types) class definitions\n\n#### [13] `factories.py`\n\nContains [Factory Boy](https://factoryboy.readthedocs.io/) factories\n\n#### [14] `filters.py`\n\nContains [django-filter](https://django-filter.readthedocs.io/) classes\n\n#### [15] `functions.py`\n\nContains functions which are related with the business logic. Most of functions should be in this file. For example:\n\n- Function to calculate SLA from work hour\n- Function to removing expired products\n- etc\n\n#### [16] `tasks.py`\n\nContains [Celery](https://docs.celeryproject.org/en/stable/index.html) tasks\n\n#### [17] `utils.py`\n\nContains **utility** functions which are not related with the business logic. For example:\n\n- Date formatting\n- Manipulating string\n- etc\n\n#### [18] Requirements\n\nUsing [`pip-tools`](https://github.com/jazzband/pip-tools) you can compile `requirements.in` into `requirements.txt` automatically.\n\n#### [19] `common` Application\n\nThe `common` application is the application that you can put any code which is reused in many applications. You can put filters, permission classes, managers, and etc here. This is because of the [DRY](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) principle.\n\n> Note: Inside `common` application, it should follow the standard of application as well.\n\n#### [20] Third-Party Services\n\nIf your application connects to third-party services, this is where you want to put the service-related logics.\n\n#### [21] Fixtures\n\nPut your JSON fixtures here.\n\n#### [22] Fixture Template\n\nContain reusable set of fixtures, read more [here](/django/unit-test/#fixtures).",
            "url": "/technical-standard/django/project-structure/"
        }, "django-python-style-guide": {
            "title": "Python Style Guide (Optional)",
            "content": "\n\n\n**this page is in draft mode. it is optional to follow guidelines on this page.**\n\n\n\n\n## Base Style guide\n\nWe follow [Google style guide for Python](https://google.github.io/styleguide/pyguide.html). The rest of the document describes additions and clarifications.\n\n## Linting\n\n* You can use `pylint` with this [pylintc](https://google.github.io/styleguide/pylintrc) to check if your code passed the standard.\n\n## Formatter\n\n* You can use [yapf](https://github.com/google/yapf/) to avoid arguing over formatting.\n* For PyCharm users, you can configure `yapf` as an external tool, see [How to config Pycharm](#pycharm-configuration).\n* For VSCode users, in `setting.json` set `\"python.formatting.provider\": \"yapf\",`\n\n### PyCharm Configuration\n\nYAPF can be configured as an “External Tool” inside PyCharm and run on a per-file basis. Go to File -> Settings -> Tools -> External Tools and click +. In the dialog that opens enter the following details:\n\n* Name: YAPF\n* Description: Run Yapf formatter on current file\n* Program: \\\n* Arguments: `-i $FilePath$`\n* Working directory: `$ProjectFileDir$`\n\n\\ is the full path to the YAPF executable on your system:\n\n* Linux/Mac: `/usr/bin/yapf` if installed with a package manager or `$HOME/.local/bin/yapf` if installed with pip\n* Windows: `\\Scripts\\yapf.exe`\n\nA YAPF item should now appear in the Tools -> External Tools menu. This can be bound to a shortcut key under File -> Settings -> Keymap -> External Tools.\n\n## Imports\n\nImports should be grouped in the following order\n\n* standard libraries\n* third party libraries\n* local modules\n\nEach group should be sorted lexicographically, ignoring case, separate by an empty line, e.g.\n\n```python\nimport collections\nimport queue\nimport sys\n\nfrom absl import app\nfrom absl import flags\nimport bs4\nimport cryptography\nimport tensorflow as tf\n\nfrom book.genres import scifi\nfrom myproject.backend import huxley\nfrom myproject.backend.hgwells import time_machine\nfrom myproject.backend.state_machine import main_loop\nfrom otherproject.ai import body\nfrom otherproject.ai import mind\nfrom otherproject.ai import soul\n\n```\n\nUse import statements for packages and modules only, not for individual classes or functions. Note that there is an explicit exemption for imports from the typing module.\n\n## None checks\n\nAlways use if foo is None: (or is not None) to check for a None\n\n```python\n# Yes\nif foo is not None: pass\n\n# No\nif foo: pass\n```\n\n## Getting current time in Django\n\nAlways use `timezone.now()` rather than `datetime.now()`\n\n```python\nimport datetime\n\nfrom django.utils import timezone\n\n# Yes\nnow = timezone.now()\n\n# No\nnow = datetime.datetime.now()\n```\n\n## Checking if sequence is empty\n\nFor sequences, (strings, lists, tuples), use the fact that empty sequences are false\n\n```python\n# Yes\nif seq:\nif not seq:\n\n# No\nif len(seq):\nif len(seq) == 0:\n```\n\n## Trailing commas\n\nTrailing commas in sequences of items are recommended only when the closing container token ], ), or } does not appear on the same line as the final element. The presence of a trailing comma is also used as a hint to our Python code auto-formatter YAPF to direct it to auto-format the container of items to one item per line when the , after the final element is present.\n\n```python\n# Yes\ngolomb3 = [0, 1, 3]\ngolomb4 = [ 0, 1, 4, 6,\n]\n\n# No\ngolomb4 = [ 0, 1, 4, 6\n]\n```\n\n## Joining Path\n\n```python\nimport os\n\n# Yes\ndata_path = os.path.join(data_folder, \"data.csv\")\n\n# No\ndata_path = data_folder + \"/data.csv\"\n```\n\n## Logging\n\nPrefer logging over print statement\n\n```python\nimport logging\n\n# Yes\nlogger = logging.getLogger(__name__)\n\nif bad_mojo: logger.error('Something went wrong!')\n\n\n# No\nif bad_mojo: print('Something went wrong!')\n```\n\n## With statement\n\nAlways open file with context manager\n\n```python\n# Yes\nwith open('file.txt') as file: pass\n\n# No\nfile = open('file.txt')\nfile.close()\n```\n\nFor psycopg2 connection, you should use [try catch over `with` statement](https://www.psycopg.org/docs/usage.html#with-statement). `with` statement will help commit/rollback transaction, and `try catch` will help close connection.\n\n```python\nconn = psycopg2.connect(DSN)\n\ntry: # using with statement here, it will help commit/rollback transaction. with conn:     with conn.cursor() as curs:         curs.execute(...)\n # put another transaction here. with conn:     with conn.cursor() as curs:         curs.execute(...)\nfinally: # if you don't use connection anymore, close connection in finally block. conn.close()\n```\n\n## Testing\n\nAlways write unittest if you have enough time.",
            "url": "/technical-standard/django/python-style-guide/"
        }, "django-queryset": {
            "title": "QuerySet",
            "content": "## Introduction\n\nThis guideline will base on these models:\n\n```python\nclass User(models.Model): username = models.CharField(max_length=50)\n\n\nclass Person(models.Model): user = models.ForeignKey(     'User',     on_delete=models.CASCADE,     related_name='people', ) first_name = models.CharField(max_length=50) last_name = models.CharField(max_length=150) employee_id = models.CharField(max_length=15, unique=True) active = models.Boolean(default=True, blank=True)\n\n\nclass Department(models.Model): name = models.CharField(max_length=255)\n members = models.ManyToManyField(     'Person',     related_name='departments', )\n```\n\n## Filtering\n\n### Joint Field Filtering\n\n```python\n# Yes\ndef find_people_yes(query: str): return Person.objects.annotate(     full_name=Concat('first_name', Value(' '), 'last_name'), ).filter(     full_name__icontains=query, )\n\n# No\ndef find_people_no(query: str): return Person.objects.filter(     Q(first_name__icontains=query)     | Q(last_name__icontains=query) )\n```\n\nFirst, we try to filter people with name `John`...\n\n```python\npeople = find_people_yes(query='John')\nprint(people)\n# , ]>\n\npeople = find_people_no(query='John')\nprint(people)\n# , ]>\n```\n\nEverything seems fine, right? Both techniques return the same results. But what about filtering person's name by `John Doe`?\n\n```python\npeople = find_people_yes(query='John Doe')\nprint(people)\n# ]>\n\npeople = find_people_no(query='John Doe')\nprint(people)\n# \n```\n\nNow you see the difference? It's because the second method (`find_people_no`) does not support filtering across two fields.\n\nBut in the other side, the second method give us a better performance if both fields are `db_index`'ed. The first method was using the annotated field which is not indexed.\n\nHowever, after considered those factors, we would suggest you to go with the first method.\n\n### Using `.count()` instead of `len()`\n\n```python\n# Yes\nPerson.objects.count()     # SELECT COUNT(*) FROM person\n\n# No\nlen(Person.objects.all())  # SELECT * FROM person\n```\n\n- Calling `Person.objects.count()` will count directly inside the database\n- But, calling `len(Person.objects.all())` will fetch all data from the database and count them in Python instead\n\nSo, using an aggregate function from database always consume less time that getting every records.\n\n### Using `.exists()` to check if any data exists\n\n```python\n# Yes\nif Person.objects.filter(first_name='John').exists(): do_something()\n\n# No\nif Person.objects.filter(first_name='John'): do_something()\n```\n\nUsing `.exists()` consume less resources than not using it.\n\n### Using `.first()` instead of calling `.exists()`, followed by `.get()`\n\n```python\n# Yes\nmatched_person = Person.objects.filter(employee_id='123').first()\nif matched_person is not None: do_something(matched_person)\n\n# No\nif Person.objects.filter(employee_id='123').exists(): matched_person = Person.objects.get(employee_id='123') do_something(matched_person)\n```\n\n- Calling `.first()` method will hit database only one time, and you will also get the object.\n- Calling `.exists()` method hit database one time, then calling `.get()` hit database one more time.\n\nIn this case, using `.first()` has better performance since it hit database only one.\n\nYou can read more about [When QuerySets are evaluated](https://docs.djangoproject.com/en/3.1/ref/models/querysets/#when-querysets-are-evaluated).\n\n### Avoid filtering across many relationship\n\nFiltering across _one-to-many_ or _many-to-many_ relationship can cause an unexpected result such as duplicated records.\n\nSuppose we have two departments\n\n```python\nhr = Department.objects.create(name='HRD')\naccounting = Department.objects.create(name='HRM')\n```\n\nJohn Doe is in both departments\n\n```python\njohn_doe = Person.objects.create(...)\nhr.add(john_doe)\naccounting.add(john_doe)\n```\n\nIf we try to get person who is in department that it's name contains word `HR`\n\n```python\nPerson.objects.filter(departments__name__icontains='HR')\n# , ]>\n```\n\nWe will get duplicated records because John Doe is in both departments. The solution for this case is to use `.distinct()`\n\n```python\nPerson.objects.filter(departments__name__icontains='HR').distinct()\n# ]>\n```\n\nIf you are using `PostgreSQL` as a database backend, you can specify field `id` in `.distinct()` to improve the performance. Note that you will need to order the queryset by `id` as well\n\n```python\nPerson.objects.filter(departments__name__icontains='HR').order_by('id').distinct('id')\n# ]>\n```\n\n### No need to use `.all()` before `.filter()`\n\nIf you're using `.filter()` in your queryset, then you don't need to provide `.all()` anymore\n\n```python\n# Yes\nPerson.objects.filter(first_name='John')\n\n# No\nPerson.objects.all().filter(first_name='John')\n```\n\n### Avoid filtering against `JSONField`\n\nFiltering against `JSONField` can cause a huge performance degrades.\n\nIf it is really needed to filter, then you might need to consider refactoring your model by using database relation (such as _one-to-many_ or _many-to-many_) to represent your data instead.\n\n### `Q() | Q()` is more preferred than union queryset\n\n```python\n# Yes\nqueryset = Person.objects.filter( Q(first_name='John') | Q(last_name='Doe')\n)\n\n# No\nqueryset = Person.objects.filter(first_name='John')\nqueryset.union( Person.objects.filter(last_name='Doe')\n)\n```\n\nThe first method will generate a query such as `SELECT ... FROM ... WHERE ... OR ...` which is faster than the second one which will generate `SELECT ... FROM ... WHERE ... UNION SELECT ... FROM ... WHERE ...`.\n\n## Manipulating Data\n\n### `.update()` is more preferred than looping save models\n\n```python\n# Yes\nPerson.objects.update(active=False)  # hit database\n\n# No\nfor person in Person.objects.all(): person.active = False person.save()                    # hit database (n times)\n```\n\nCalling `QuerySet.update()` will produce a single query using `UPDATE ... WHERE ...`. It is faster than looping update the model in Python which hit database every iteration.\n\n> **WARNING:** Calling `.update()` won't trigger `post_save` signal.\n\n### Refresh model from database\n\n```python\n# Getting John\njohn = Person.objects.get(first_name='John', active=True)\n# Set John to inactive\nPerson.objects.filter(pk=person.pk).update(active=False)\n\nprint(john.active)\n# True\n\njohn.refresh_from_db(fields=['active'])\nprint(john.active)\n# False\n```\n\nWhen you update a model field using `.update()`, a local instance won't update automatically. You'll need to call `.refresh_from_db()` to refresh an instance from database.\n\nSometimes you might need refresh the whole queryset. In this case, you can query it again by calling `.all()`\n\n```python\nqueryset = Person.objects.all()\nqueryset.filter(first_name='John').update(active=False)\n\n# update the whole queryset\nqueryset = queryset.all()\n```\n\n## Related Models\n\n### Using `.select_related()` and `.prefetch_related()`\n\n```python\n# Yes\nperson = Person.objects \\ .select_related('user') \\ .prefetch_related('departments') \\ .first()                                 # hit database\nprint(person.first_name)\nprint(person.user.username)\nprint(person.departments.all())\n\n# No\nperson = Person.objects.first()              # hit database\nprint(person.first_name)\nprint(person.user.username)                  # hit database\nprint(person.departments.all())              # hit database\n```\n\nThe second method seems short and easy to understand. But behind that, it hits database 3 times.\n\n> **WARNING:** Calling `person.departments.filter(name='HR')` in both methods will hit database since it needs to query database to find the records which matched the given condition. `prefetch_related` does not help you in this situation.\n\n### Select/Prefetch related only when you're using those values\n\n```python\nany_user = User.objects.first()\n\n# No need to use `select_related` since you only filter it.\nPerson.objects.filter(user=any_user)\n\n# You need to, because you're accessing user instance\nperson = Person.objects.select_related('user').first()\ndo_something(person.user.username)\n```\n\n### Avoid comparing instance if not select/prefetch related\n\n```python\nperson = Person.objects.first()\nuser = User.objects.first()\n\n# Yes\nif person.user_id == user.pk:    # no database hit do_something()\n\n# No\nif person.user == user:          # hit database do_something()\n```\n\nThe first method doesn't hit the database because field `user_id` is in `Person` instance locally.\n\nThe second one hit the database because accessing `user` property makes Django to query `User` instance.\n\n## Custom Manager\n\n### Repeat filtering logics\n\nIf you have any repeat filtering logics, it is recommended to adding an extra manager function instead of repeating yourself in multiple location.\n\n```python\nclass PersonManager(models.Manager): def only_inactive(self):     return self.filter(active=False)\n\n\nclass Person(models.Model): ... objects = PersonManager()\n\n\n# Then you can call it with\nPerson.objects.only_inactive()\n```\n\n### Override default queryset\n\nFor example, if you want the default behavior to filter only active person.\n\n```python\nclass PersonManager(models.Manager): def get_queryset(self):     return super().get_queryset().filter(active=True)\n\n\nclass Person(models.Model): ... objects = PersonManager()\n\n\nPerson.objects.all()  # will now showing only active person\n```\n\n## Other\n\n### Using `.only()` to optimize performance\n\nIn case you want to process only person's first name, using `.only()` will result a better performance.\n\n```python\nPerson.objects.only('first_name')  # faster\nPerson.objects.all()\n```\n\n> **WARNING:** If you try to get field that is not in `.only()`, Django will query the database again to get the field.\n\n### Difference between `.only()` and `.values()`\n\nBoth of them are getting only for selected field(s). But,\n\n- `.only()` produce a model instance which you still can get any other field from the result\n- `.values()` produce a dictionary. So, you cannot get any other field from the result\n\n```python\nperson = Person.objects.only('first_name').first()\nprint(person)\n# \nprint(person.first_name)\n# John\nprint(person.last_name)     # hit database\n# Doe\n\nperson = Person.objects.values('first_name').first()\nprint(person)\n# {'first_name': 'John'}\nprint(person['first_name'])\n# John\nprint(person['last_name'])  # raise KeyError\n```\n\n### No Raw SQL\n\nWriting query in _Raw SQL_ format can cause many problems.\n\nThe most important reason is _the difficulty to maintain_. If you write a lot of queries, it will be difficult to understand the logics of those queries. Makes it difficult to modify as well.\n\nThe second one is _security_. Writing _Raw SQL_ can cause a SQL injection if you don't carefully escape every parameters used in the queries.\n\nThe last reason is _it can goes wrong easily_. By using _Raw SQL_, you'll need to write it as a plain text. If you're using IDE that support validating SQL language, you might be lucky. But if you aren't, you'll easily mess things up. Checking with a real database query should be done frequently.\n\nDjango provides a lot of utility functions which can help you writing queries without using _Raw SQL_ such as [Subquery](https://docs.djangoproject.com/en/3.1/ref/models/expressions/#subquery-expressions), [Func](https://docs.djangoproject.com/en/3.1/ref/models/expressions/#func-expressions), [Aggregate](https://docs.djangoproject.com/en/3.1/ref/models/expressions/#aggregate-expressions), and etc.\n\nAnyway, there might be a case that you cannot prevent using _Raw SQL_. If that time comes, please be very careful.\n\n---\n\n## References\n\n- [QuerySet API reference](https://docs.djangoproject.com/en/3.1/ref/models/querysets/)\n- [Making queries](https://docs.djangoproject.com/en/3.1/topics/db/queries/)\n- [Managers](https://docs.djangoproject.com/en/3.1/topics/db/managers/)",
            "url": "/technical-standard/django/queryset/"
        }, "django-readme": {
            "title": "Django README Instructions",
            "content": "This page will give you recommendations on how to write `README.md` file for your Django project.\n\n## Topics\n\n README.md ├── Requirements │   # requirement version of Docker, Docker-Compose, etc. │ ├── Setup Project │   # Steps for setup project for the first time. │ ├── Run Project │   # Steps for running project after developer have already setup the project. │ ├── Account │   ├── API │   │    # Account for login to localhost API for admin and regular user │   └── DB │        # Account for access localhost DB. │ ├── Miscellaneous Tools │   ├── Clean Project │   │   # Steps for cleaning project (clear project docker image/containers, reset db) │   │ │   ├── Reset DB │   │    # Steps for reset DB │   │ │   ├── Dump DB │   │    # Steps for dump localhost DB │   │ │   └── Restore DB │        # Steps for restore localhost DB │ └── Other topics      # For example, custom config Celery/RabbitMQ, setup some complex data, etc.\n\n\n## Example\n\nSee sample [here](/technical-standard/django/readme/sample.html)",
            "url": "/technical-standard/django/readme/"
        }, "django-serializers": {
            "title": "Serializers",
            "content": "## Model Serializer\n\nBasic usage of ModelSerializer\n\n* Need to provide one of the attributes `fields` or `exclude`\n* Prefer to use [Third party packages](https://www.django-rest-framework.org/api-guide/serializers/#third-party-packages) instead of writing on your own\n* Use `select_related` and `prefetch_related` to improve queries performance\n\n```python\n# serializers.py\nfrom res_framework import serializers\n\n# Yes\nclass AccountSerializer(serializers.ModelSerializer): class Meta:     model = Account     fields = ['id', 'account_name', 'users', 'created']\n\n# Yes\nclass AccountSerializer(serializers.ModelSerializer): class Meta:     model = Account     fields = '__all__'\n\n# Yes\nclass AccountSerializer(serializers.ModelSerializer): class Meta:     model = Account     exclude = ['users']\n```\n\n### ModelControllerSerializer\n\nIf your model extends from `AbstractModelController` use `ModelControllerSerializer`\n\n```python\n# serializers.py\nfrom model_controller import serializers as mc_serializers\nfrom res_framework import serializers\n\n\n# Yes \nclass AccountSerializer(mc_serializers.ModelControllerSerializer): pass\n\n# No\nclass AccountSerializer(serializers.ModelSerializer): def create(self, validated_data):     user = self.context['request'].user\n     validated_data['created_user'] = user     validated_data['updated_user'] = user\n     return super().create(validated_data)\n def update(self, instance, validated_data):     user = self.context['request'].user\n     validated_data['updated_user'] = user\n     return super().update(instance, validated_data)\n```\n\n## Fields\n\n### SerializerMethodField\n\nIf it's just a property of object you can use `source` instead\n\n```python\n# serializers.py\nfrom rest_framework import serializer\n\n# Yes\nclass ProfileSerializer(serializers.ModelSerializer): username = serializers.CharField(source='user.username')\n\n# No\nclass ProfileSerializer(serializers.ModelSerializer): username = serializers.SerializerMethodField()\n def get_username(self, obj):     return obj.username\n\n```\n\n### HiddenField\n\nUse [HiddenField](https://www.django-rest-framework.org/api-guide/fields/#hiddenfield) to provide a predefined value\n\n```python\nfrom django.utils import timezone\nfrom rest_framework import serializers\n\n# Yes\nclass EmailSerializer(serializers.ModelSerializer): modified = serializers.HiddenField(default=timezone.now)\n\n# No\nclass EmailSerializer(serializers.ModelSerializer): def create(self, validated_data):     validated_data['modified'] = timezone.now()     return super().create(validated_data)  def update(self, instance, validated_data):     validated_data['modified'] = timezone.now()     return super().create(instance, validated_data) \n\n```\n\n## CreateOnlyDefault\n\nUse [CreateOnlyDefault](https://www.django-rest-framework.org/api-guide/validators/#createonlydefault) to set a default argument during create operations\n\n```python\nfrom rest_framework import serializers\n\n# Yes\nclass EmailSerializer(serializers.ModelSerializer): owner = serializers.CreateOnlyDefault(default=serializers.CurrentUserDefault())\n\n# No\nclass EmailSerializer(serializers.ModelSerializer): def create(self, validated_data):     owner = self.context['request'].user     return super().create(validated_data))\n\n```\n\n## Validation\n\n* Prefer to use [DRF Validators](https://www.django-rest-framework.org/api-guide/validators/) over custom validation functions\n\n### Field level Validation\n\nYour `validate_` methods should return a validated value or raise `serializers.ValidationError`\n\n```python\nfrom rest_framework import serializers\n\n# Yes\nclass BlogPostSerializer(serializers.Serializer): title = serializers.CharField(max_length=100) content = serializers.CharField()\n def validate_title(self, value):     if 'django' not in value.lower():         raise serializers.ValidationError(\"Blog post is not about Django\")     return value\n\n\n# No \nclass BlogPostSerializer(serializers.Serializer): title = serializers.CharField(max_length=100) content = serializers.CharField()\n def validate_title(self, value):     if 'django' not in value.lower():         raise ValueError(\"Blog post is not about Django\")     return value\n```\n\n### Object level validation\n\nDo not manipulate the data while doing object level validation\n\n```python\nfrom rest_framework import serializers\n\n# Yes\nclass EventSerializer(serializers.Serializer): description = serializers.CharField(max_length=100) start = serializers.DateTimeField() finish = serializers.DateTimeField()\n def validate(self, data):     if data['start'] > data['finish']:         raise serializers.ValidationError(\"finish must occur after start\")     return data\n\n# No\nclass EventSerializer(serializers.Serializer): description = serializers.CharField(max_length=100) start = serializers.DateTimeField() finish = serializers.DateTimeField()\n def validate(self, data):     data['description'] = 'some description'     if data['start'] > data['finish']:         raise serializers.ValidationError(\"finish must occur after start\")     return data\n```",
            "url": "/technical-standard/django/serializers/"
        }, "django-third-party-library": {
            "title": "Third-Party Library Guideline",
            "content": "Best practices for which library to use and how to choose.\n\n## How to choose a library?\n\nHere are some checklist when choosing a new library:\n\n- Check the amount of star in GitHub, the more star the better.\n- Check if documentation is available.\n- Check how often library getting updates.\n- Check when is the latest code update, if the latest update was years ago meaning\nthe library probably not being maintained anymore.\n- Check if there are unit tests, usually good code come with unit test.\n- You can get more analytics from the **Insights** tab in GitHub, to see if\nthe community with this library is good enough.\n- Check security report in **Security** tab.\n\n## Recommended Libraries\n\nThese are the recommended library for each categories. This does not mean that\nevery project must install all the libraries listed here. **Only install what\nyou need to use**. Best practices is install when you need instead of install\nfrom all at once, keep your requirements growing.\n\n### Common\n\n- [Django](https://www.djangoproject.com): web framework.\n- [Rest Framework](https://www.django-rest-framework.org): API Endpoint.\n- [Simple JWT](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/): authentication with JSON Web Token.\n- [CORS Header](https://github.com/adamchainz/django-cors-headers): browser CORS header.\n- [API Key](https://florimondmanca.github.io/djangorestframework-api-key/) implementing API Key authorization.\n- [Filter](https://django-filter.readthedocs.io/en/stable/): filter data from URL parameters.\n- [Model Controller](https://github.com/NorakGithub/django-model-controller): keeping track of database record.\n- [Sequences](https://pypi.org/project/django-sequences/): sequence generator.\n- [Redis](https://pypi.org/project/redis/): connecting to redis server.\n\n### Background Worker\n\n- [Celery](https://docs.celeryproject.org/en/stable/django/first-steps-with-django.html) background worker.\n\n### Excel\n\n- [OpenPyXL](https://openpyxl.readthedocs.io/en/stable/): working with Excel\n- [Excel Tool](https://pypi.org/project/django-excel-tools/): validate data from excel\n\n### PDF\n\n- [WeasyPrint](https://weasyprint.readthedocs.io): generate PDF from HTML\n\n### Development\n\n- [Debug Toolbar](https://django-debug-toolbar.readthedocs.io/en/latest/): optimizing API performance.\n- [Environ](https://django-environ.readthedocs.io/en/latest/): helper when using environment variable.\n- [ipdb](https://github.com/gotcha/ipdb): extended from pdb for code completion and more.\n- [DRF Spectacular](https://github.com/tfranzel/drf-spectacular): generating API Doc for Django REST Framework.\n\n### Unit Test\n\n- [Test Without Migrations](https://pypi.org/project/django-test-without-migrations/): speed up testing without running database migration and playing around with model design.\n- [Factory Boy](https://factoryboy.readthedocs.io/en/stable/orms.html): mocking model data.\n- [Slow Test](https://github.com/realpython/django-slow-tests): reporting which unit test run too slow.\n- [Coverage](https://docs.djangoproject.com/en/3.1/topics/testing/advanced/#integration-with-coverage-py): reporting amount of code that covered by unit test.\n- [Freezegun](https://github.com/spulec/freezegun): freeze time for testing.\n\n### Monitoring\n\n- [Sentry-SDK](https://docs.sentry.io/platforms/python/guides/django/): unhandled exception report",
            "url": "/technical-standard/django/third-party-library/"
        }, "django-unit-test": {
            "title": "Unit Test",
            "content": "## Common Best Practices\n\n- If you don't know what are the unit test for your function should be, try not\nto use other testing tools like, Browser or Postman etc. The only tool to test\nif your code run correctly is unit test.\n- If the test is for Django Model, Form or View etc, use `django.test.TestCase`.\n- If the test is for Django REST, use `rest_framework.test.APITestCase`.\n- Test must be isolated, it must not required other test case to pass.\n- Test must not required to run in sequential.\n- Test function name should tell what intended to do and the reason why it failed or passed.\n\n```python\n# Yes\ndef test_create_person_should_fail_when_name_is_already_existed(self): ...\n\n# No\ndef test_api(self): ...\n```\n\n- Show more information when assertion failed, easy for debugging.\n\n```python\n# Yes\ndef test_create_person_should_success(self): res = self.client.post(url, data) self.assertEqual(res.status, HTTP_201_CREATED, res.json())\n\n# No\ndef test_create_person_should_success(self): res = self.client.post(url, data) self.assertEqual(res.status, HTTP_201_CREATED)\n```\n\n- Use `setUp` method to create a sharable data in the current test suite.\n- Do not hardcoded url, use `reverse` instead.\n\n```python\nclass TestSimple(TestCase): def setUp(self):     self.user = User.objects.get(id=1)     # Yes     self.url = reverse('api:person')     # No     self.url = '/api/person/'  def test_something_should_be_succeed(self):     self.url ...     self.user ...  def test_something_should_be_failed(self):     self.url ...     self.user ...\n```\n\n- Use Django Build-in assertion instead of python assertion, because it provided\nmore information when assertion failed.\n\n```python\nclass TestSimple(TestCase): def test_something_should_be_failed(self):     # Yes     self.assertIsNotNone(...)     self.assertIsNone(...)     self.assertTrue(...)     self.assertFalse(...)     self.assertEqual(...)     # No     assert a is not None     assert b is None     assert a == True     assert b == False     assert a == b\n```\n\n- You don't have to coverage 100% of unit test, but you must at least sure that\nyour code work as intended.\n- Do not write unit test for third-party packaged or framework you are using,\nbecause it should already have its own unit test.\n\n## Fixtures\n\n### Introduction\n\nYou should use fixtures if it's the kind of data that will be reusable. Example:\n\n- Role\n- Type\n\n### Rules\n\nName of fixture should be noun in plural form.\n\n```python\n# Yes  \nusers.json  \npeople.json\ndepartments.json\n\n# No\ndo_something.json  # Not Noun\npersons.json  # Incorrect grammar\n```\n\nOne JSON fixture file for one model.\n\n```json\n# Yes\n[ {\"model\": \"app.Model\", \"pk\": 1, ...}, {\"model\": \"app.Model\", \"pk\": 2, ...}\n]\n\n# No\n[ {\"model\": \"app.Model1\", \"pk\": 1, ...}, {\"model\": \"app.Model2\", \"pk\": 1, ...}\n]\n```\n\nDo not write your own fixtures, always generate from Django Admin command line.\n\n```shell script\n$ python manage.py dumpdata app.Model >> path/app/fixtures/model.json\n```\n\nIf you have a set of fixtures that can be reusable, consider creating a reusable constants.\n\n```python\n# Yes\n## fixture_templates.py\nUSERS = [ 'users.json',\n]\n\nPEOPLE = USERS + [ 'people.json',\n]\n\n## tests.py\nclass UserTest(tests.TestCase): fixtures = fixture_templates.PEOPLE\n\nclass PersonTest(tests.TestCase): fixtures = fixture_templates.PEOPLE\n\n# No\nclass UserTest(tests.TestCase): fixtures = [     'users.json',     'people.json', ]\n\nclass PersonTest(tests.TestCase): fixtures = [     'users.json',     'people.json', ]\n```\n\n**Note:** The `fixture_templates.py` file should be in `common` app directory.\n\n## Parallel Testing\n\nRunning test in parallel could speed up your test suite. [Read More](https://docs.djangoproject.com/en/3.1/ref/django-admin/#cmdoption-test-parallel)\n\nSample usage:\n\n```shell script\npython manage.py test --parallel=2\n# With docker-compose\ndocker-compose exec django python manage.py test --parallel=2\n```\n\nIf you are using test coverage, make sure to run combine after run the coverage:\n\n```shell script\n$ coverage run\n$ coverage combine\n$ coverage report -m\n```",
            "url": "/technical-standard/django/unit-test/"
        }, "django-viewsets": {
            "title": "ViewSets",
            "content": "## ModelViewset\n\n### Basic ModelViewSet\n\nBasic usage of ModelViewset is to define 2 objects\n\n* queryset - database query for your model\n* serializer_class - class for converting model query into JSON string.\n\n```py\nfrom rest_framework.viewsets import ModelViewSet\n\nclass MyViewSet(ModelViewSet): # define queryset. queryset = MyModel.objects.all()\n # define serializer. serializer_class = MyModelSerializer\n```\n\n### Skip Authenitcation Checking\n\nUse AllowAny if you want to skip authentication checking.\n\n```py\nclass MyViewSet(ModelViewSet): # Use AllowAny if you want to skip authentication checking. permission_classes = (AllowAny,)\n```\n\n### Customize Seriailizer\n\nIf you want different serializer for GET/POST request, you can use following attribute:\n\n* list_serializer_class - for GET request\n* retrieve_serializer_class - for GET request with item ID\n* write_serializer_class - for POST request\n\n```py\n# Good:\nclass MyViewSet(ModelViewSet): # define serializer for GET request list_serializer_class = MyModelListSerializer\n # define serializer for GET request with item ID retrieve_serializer_class = MyModelDetailSerializer\n # define serializer for POST request write_serializer_class = MyModelWriteSerializer\n\n\n# Bad:\nclass MyViewSet(ModelViewSet): serializer_class = MyModelSerializer\n def get_serializer_class(self):     serializer = super().get_serializer_class()\n     if self.request.method == 'GET':         if self.kwargs.get('pk'):             return MyModelDetailSerializer         else:             return MyModelListSerializer     elif self.request.method == 'POST':         return MyModelWriteSerializer     else         return serializer\n```\n\n### Use Django Built-in FilterClass/Ordering\n\nFor simple search/filter/ordering, use Django built-in FilterClass. To setup, run `pip install django-filter`. Then add `'django_filters'` to Django's `INSTALLED_APPS`\n\n```py\n# Good:\nfrom django_filters.rest_framework import DjangoFilterBackend\nfrom rest_framework import filters\nclass MyViewSet(ModelViewSet): filter_backends = [filters.SearchFilter, DjangoFilterBackend, filters.OrderingFilter]\n # DjangoFilterBackend used for equality filter. #   Ex. localhost:8000/api/department/?name=ABC #      it will search for name='ABC' #   Ex. localhost:8000/api/department/?name_en=ABC #      it will search for name_en='ABC' filterset_fields = ['name', 'name_en']\n # SearchFilter used for searching multiple fields at once. # Ex. localhost:8000/api/department/?search=ABC #    it will search for field 'name' contains 'ABC' or 'name_en' contains 'ABC' search_fields = ['name', 'name_en', ]\n\n # OrderingFilter used for controlling order results. # Ex. localhost:8000/api/department/?ordering=account,-username #     it will order by account ascending, then username descending ordering_fields = ['username', 'account'] # set default ordering. ordering = ['username']\n\n\n# Bad:\nclass MyViewSet(ModelViewSet): def get_queryset(self):     queryset = super().get_queryset()\n     name = self.request.GET.get('name')     if name:         queryset = queryset.filter(name=name)\n     name_en = self.request.GET.get('name_en')     if name_en:         queryset = queryset.filter(name_en=name_en)\n     search = self.request.GET.get('search')     ...\n     ordering = self.request.GET.get('ordering')     ...\n     return queryset\n\n```\n\n### Viewset Actions\n\nYou can create custom url for viewset by using `@action` decorator. It is better than creating separated APIViews.\n\n```py\nclass MyViewset(viewsets.ModelViewSet): queryset = MyModel.objects.all() serializer_class = MyModelSerializer\n @action(detail=False, methods=['GET'], url_name='my_reverse_url_name', url_path='my_url_path') def my_custom_viewset_action(self, request):     # do something ...     return Response( ... )\n```\n\nThen, in your api_urls.py\n\n```py\nrouter.register(r'my-viewset', MyViewset)\n```\n\nYou can call GET `localhost:8000/my-viewset/my_url_path/` which Django will call function `my_custom_viewset_action`\n\nIf you set `detail=True` in action parameters, you need to add `pk` parameter in your action function.\n\n```py\n@action(detail=True, methods=['GET'], url_name='my_reverse_url_name', url_path='my_url_path')\ndef my_custom_viewset_action(self, request, pk): # do something ... return Response( ... )\n```\n\nFor example: calling GET `localhost:8000/my-viewset/10/my_url_path/` which Django will call function `my_custom_viewset_action` with parameter `pk=10`\n\n### Use Custom FilterClass\n\nIn case that Django Built-In FilterClass does not meet your requirements. You can create your own FilterClass and set it in ModelViewset below.\n\n```py\nclass MyViewSet(ModelViewSet): # define filterclass filter_class = MyModelFilter\n def get_queryset(self):     #     # In case you want to modify queryset.     # This function will be called before queryset goes to FilterClass     #     queryset = super().get_queryset()\n     #     # do something here. Ex. You can add .select_related() to queryset in some conditions.     #     if some_conditions:         queryset = queryset.select_related('...')\n     return queryset\n```\n\n### Customize HTTP Method\n\nYou should limit http method that user can call to the server. ModelViewset will enable all methods by default.\n\n```py\n# Good\nclass MyViewSet(ModelViewSet): queryset = MyModel.objects.all() serializer_class = MyModelSerializer http_method_names = ['get', 'head', 'post', 'patch']\n\n# Bad\nclass MyViewset(ModelViewSet): queryset = MyModel.objects.all() serializer_class = MyModelSerializer\n def get_queryset(self):     if not self.request.method in ['GET', 'POST', 'PATCH']:         raise Exception('method invalid')     else         return super().get_queryset()\n```\n\n## Generic Views\n\n### ReadOnlyModelViewSet\n\nUse ReadonlyModelViewset if you want request in GET and GET with item id only.\n\n```py\n# Good\nclass MyViewSet(ReadOnlyModelViewSet): queryset = MyModel.objects.all() serializer_class = MyModelSerializer\n\n\n# Bad\nclass MyViewSet(ModelViewSet): queryset = MyModel.objects.all() serializer_class = MyModelSerializer http_method_names = ['get', 'head']\n```\n\n### Other Generic Views\n\nMoreover, there are many generic views as follows\n\n| Generic View Class           | GET (Listing) | GET (item ID) | POST | PUT/PATCH | DELETE |\n|------------------------------|---------------|---------------|------|-----------|--------|\n| CreateAPIView                |               |               |   Y  |           |        |\n| ListAPIView                  |       Y       |               |      |           |        |\n| RetrieveAPIView              |               |       Y       |      |           |        |\n| DestroyAPIView               |               |               |      |           |    Y   |\n| UpdateAPIView                |               |               |      |     Y     |        |\n| ListCreateAPIView            |       Y       |               |   Y  |           |        |\n| RetrieveUpdateAPIView        |               |       Y       |      |     Y     |        |\n| RetrieveDestroyAPIView       |               |       Y       |      |           |    Y   |\n| RetrieveUpdateDestroyAPIView |               |       Y       |      |     Y     |    Y   |\n\n## APIView\n\nUse APIView if request does not specifically belongs to some model. Use JsonResponse or Response instead of HttpResponse\n\n```py\n# Good\nfrom django import http\nclass UserViewSet(views.APIView): def get(self, request):     return http.JsonResponse({         'users': 123,     })\n\n# Good\nfrom rest_framework.response import Response\nclass UserViewSet(views.APIView): def get(self, request):     return Response(data={         'users': 123,     })\n\n# Bad\nclass UserViewSet(views.APIView): def get(self, request):     response_json_str = json.dumps({         'users': 123,     })     return http.HttpResponse(response_json_str, content_type=\"application/json\", status=200)\n\n```\n\nUse HttpResponseStatus instead of status number\n\n```py\n# Good\nfrom rest_framework import status\nclass UserViewSet(views.APIView): def post(self, request):     return Response(data={}, status=status.HTTP_201_CREATED)\n\n# Bad\nclass UserViewSet(views.APIView): def post(self, request):     return Response(data={}, status=201)\n\n```\n\n> If you want to use status 200 (OK), it is not necessary to write because it is the default status code for the response.",
            "url": "/technical-standard/django/viewsets/"
        }, "feed-xml": {
            "title": "",
            "content": "{% if page.xsl %}{% endif %}Jekyll{{ site.time | date_to_xmlschema }}{{ page.url | absolute_url | xml_escape }}{% assign title = site.title | default: site.name %}{% if page.collection != \"posts\" %}{% assign collection = page.collection | capitalize %}{% assign title = title | append: \" | \" | append: collection %}{% endif %}{% if page.category %}{% assign category = page.category | capitalize %}{% assign title = title | append: \" | \" | append: category %}{% endif %}{% if title %}{{ title | smartify | xml_escape }}{% endif %}{% if site.description %}{{ site.description | xml_escape }}{% endif %}{% if site.author %}{{ site.author.name | default: site.author | xml_escape }}{% if site.author.email %}{{ site.author.email | xml_escape }}{% endif %}{% if site.author.uri %}{{ site.author.uri | xml_escape }}{% endif %}{% endif %}{% if page.tags %}{% assign posts = site.tags[page.tags] %}{% else %}{% assign posts = site[page.collection] %}{% endif %}{% if page.category %}{% assign posts = posts | where: \"category\", page.category %}{% endif %}{% unless site.show_drafts %}{% assign posts = posts | where_exp: \"post\", \"post.draft != true\" %}{% endunless %}{% assign posts = posts | sort: \"date\" | reverse %}{% assign posts_limit = site.feed.posts_limit | default: 10 %}{% for post in posts limit: posts_limit %}{% assign post_title = post.title | smartify | strip_html | normalize_whitespace | xml_escape %}{{ post_title }}{{ post.date | date_to_xmlschema }}{{ post.last_modified_at | default: post.date | date_to_xmlschema }}{{ post.id | absolute_url | xml_escape }}{% assign excerpt_only = post.feed.excerpt_only | default: site.feed.excerpt_only %}{% unless excerpt_only %}{{ post.content | strip | xml_escape }}{% endunless %}{% assign post_author = post.author | default: post.authors[0] | default: site.author %}{% assign post_author = site.data.authors[post_author] | default: post_author %}{% assign post_author_email = post_author.email | default: nil %}{% assign post_author_uri = post_author.uri | default: nil %}{% assign post_author_name = post_author.name | default: post_author %}{{ post_author_name | default: \"\" | xml_escape }}{% if post_author_email %}{{ post_author_email | xml_escape }}{% endif %}{% if post_author_uri %}{{ post_author_uri | xml_escape }}{% endif %}{% if post.category %}{% elsif post.categories %}{% for category in post.categories %}{% endfor %}{% endif %}{% for tag in post.tags %}{% endfor %}{% if post.excerpt and post.excerpt != empty %}{{ post.excerpt | strip_html | normalize_whitespace | xml_escape }}{% endif %}{% assign post_image = post.image.path | default: post.image %}{% if post_image %}{% unless post_image contains \"://\" %}{% assign post_image = post_image | absolute_url %}{% endunless %}{% endif %}{% endfor %}",
            "url": "/technical-standard/feed.xml"
        }};
</script>
<script src="https://unpkg.com/lunr/lunr.min.js"></script>
<script type="text/javascript">
    (function () {
        function displaySearchResults(results, store) {
            var searchResults = document.getElementById('search-results');

            if (results.length) { // Are there any results?
                var appendString = '';

                for (var i = 0; i < results.length; i++) {  // Iterate over the results
                    var item = store[results[i].ref];
                    appendString += '<li><a href="' + item.url + '"><h3>' + item.title + '</h3></a>';
                    appendString += '<p>' + item.content.substring(0, 150) + '...</p></li>';
                }

                searchResults.innerHTML = appendString;
            } else {
                searchResults.innerHTML = '<li>No results found</li>';
            }
        }

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split('&');

            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split('=');

                if (pair[0] === variable) {
                    return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
                }
            }
        }

        var searchTerm = getQueryVariable('query');

        if (searchTerm) {
            document.getElementById('search-box').setAttribute("value", searchTerm);

            // Initalize lunr with the fields it will be searching on. I've given title
            // a boost of 10 to indicate matches on this field are more important.
            var idx = lunr(function () {
                this.field('id');
                this.field('title', { boost: 10 });
                this.field('content');

                for (var key in window.store) { // Add the data to lunr
                    this.add({
                        'id': key,
                        'title': window.store[key].title,
                        'content': window.store[key].content
                    });
                }
            });

            var results = idx.search('*' + searchTerm + '*'); // Get lunr to perform a search
            displaySearchResults(results, window.store); // We'll write this in the next section
        }
    })();
</script>


        

        
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/technical-standard/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">CODIUM Technical Standard</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">CODIUM Technical Standard</li><li><a class="u-email" href="mailto:contact@codium.co">contact@codium.co</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/c0d1um"><svg class="svg-icon"><use xlink:href="/technical-standard/assets/minima-social-icons.svg#github"></use></svg> <span class="username">c0d1um</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>CODIUM Co., Ltd.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
